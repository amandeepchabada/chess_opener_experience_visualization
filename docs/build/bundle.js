var app=function(){"use strict";function e(){}const t=e=>e;function n(e){return e()}function r(){return Object.create(null)}function o(e){e.forEach(n)}function l(e){return"function"==typeof e}function i(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let s;function a(e,t){return s||(s=document.createElement("a")),s.href=t,e===s.href}function c(t,...n){if(null==t)return e;const r=t.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}function u(e,t,n){e.$$.on_destroy.push(c(t,n))}function f(e,t,n,r){return e[1]&&r?function(e,t){for(const n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](r(t))):n.ctx}const p="undefined"!=typeof window;let d=p?()=>window.performance.now():()=>Date.now(),g=p?e=>requestAnimationFrame(e):e;const h=new Set;function v(e){h.forEach((t=>{t.c(e)||(h.delete(t),t.f())})),0!==h.size&&g(v)}function m(e,t){e.appendChild(t)}function b(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function x(e){const t=M("style");return function(e,t){m(e.head||e,t)}(b(e),t),t.sheet}function y(e,t,n){e.insertBefore(t,n||null)}function $(e){e.parentNode.removeChild(e)}function w(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function M(e){return document.createElement(e)}function T(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function A(e){return document.createTextNode(e)}function E(){return A(" ")}function k(){return A("")}function _(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function C(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function S(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function N(e,t,n,r){null===n?e.style.removeProperty(t):e.style.setProperty(t,n,r?"important":"")}const P=new Map;let q,I=0;function L(e,t,n,r,o,l,i,s=0){const a=16.666/r;let c="{\n";for(let e=0;e<=1;e+=a){const r=t+(n-t)*l(e);c+=100*e+`%{${i(r,1-r)}}\n`}const u=c+`100% {${i(n,1-n)}}\n}`,f=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(u)}_${s}`,p=b(e),{stylesheet:d,rules:g}=P.get(p)||function(e,t){const n={stylesheet:x(t),rules:{}};return P.set(e,n),n}(p,e);g[f]||(g[f]=!0,d.insertRule(`@keyframes ${f} ${u}`,d.cssRules.length));const h=e.style.animation||"";return e.style.animation=`${h?`${h}, `:""}${f} ${r}ms linear ${o}ms 1 both`,I+=1,f}function D(e,t){const n=(e.style.animation||"").split(", "),r=n.filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")),o=n.length-r.length;o&&(e.style.animation=r.join(", "),I-=o,I||g((()=>{I||(P.forEach((e=>{const{stylesheet:t}=e;let n=t.cssRules.length;for(;n--;)t.deleteRule(n);e.rules={}})),P.clear())})))}function O(e){q=e}function R(){if(!q)throw new Error("Function called outside component initialization");return q}function j(e){R().$$.on_destroy.push(e)}const B=[],K=[],Q=[],z=[],F=Promise.resolve();let U=!1;function G(e){Q.push(e)}const W=new Set;let H,V=0;function X(){const e=q;do{for(;V<B.length;){const e=B[V];V++,O(e),Y(e.$$)}for(O(null),B.length=0,V=0;K.length;)K.pop()();for(let e=0;e<Q.length;e+=1){const t=Q[e];W.has(t)||(W.add(t),t())}Q.length=0}while(B.length);for(;z.length;)z.pop()();U=!1,W.clear(),O(e)}function Y(e){if(null!==e.fragment){e.update(),o(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(G)}}function Z(e,t,n){e.dispatchEvent(function(e,t,n=!1){const r=document.createEvent("CustomEvent");return r.initCustomEvent(e,n,!1,t),r}(`${t?"intro":"outro"}${n}`))}const J=new Set;let ee;function te(){ee={r:0,c:[],p:ee}}function ne(){ee.r||o(ee.c),ee=ee.p}function re(e,t){e&&e.i&&(J.delete(e),e.i(t))}function oe(e,t,n,r){if(e&&e.o){if(J.has(e))return;J.add(e),ee.c.push((()=>{J.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}}const le={duration:0};function ie(n,r,i,s){let a=r(n,i),c=s?0:1,u=null,f=null,p=null;function m(){p&&D(n,p)}function b(e,t){const n=e.b-c;return t*=Math.abs(n),{a:c,b:e.b,d:n,duration:t,start:e.start,end:e.start+t,group:e.group}}function x(r){const{delay:l=0,duration:i=300,easing:s=t,tick:x=e,css:y}=a||le,$={start:d()+l,b:r};r||($.group=ee,ee.r+=1),u||f?f=$:(y&&(m(),p=L(n,c,r,i,l,s,y)),r&&x(0,1),u=b($,i),G((()=>Z(n,r,"start"))),function(e){let t;0===h.size&&g(v),new Promise((n=>{h.add(t={c:e,f:n})}))}((e=>{if(f&&e>f.start&&(u=b(f,i),f=null,Z(n,u.b,"start"),y&&(m(),p=L(n,c,u.b,u.duration,0,s,a.css))),u)if(e>=u.end)x(c=u.b,1-c),Z(n,u.b,"end"),f||(u.b?m():--u.group.r||o(u.group.c)),u=null;else if(e>=u.start){const t=e-u.start;c=u.a+u.d*s(t/u.duration),x(c,1-c)}return!(!u&&!f)})))}return{run(e){l(a)?(H||(H=Promise.resolve(),H.then((()=>{H=null}))),H).then((()=>{a=a(),x(e)})):x(e)},end(){m(),u=f=null}}}const se="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function ae(e){e&&e.c()}function ce(e,t,r,i){const{fragment:s,on_mount:a,on_destroy:c,after_update:u}=e.$$;s&&s.m(t,r),i||G((()=>{const t=a.map(n).filter(l);c?c.push(...t):o(t),e.$$.on_mount=[]})),u.forEach(G)}function ue(e,t){const n=e.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function fe(e,t){-1===e.$$.dirty[0]&&(B.push(e),U||(U=!0,F.then(X)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function pe(t,n,l,i,s,a,c,u=[-1]){const f=q;O(t);const p=t.$$={fragment:null,ctx:null,props:a,update:e,not_equal:s,bound:r(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(f?f.$$.context:[])),callbacks:r(),dirty:u,skip_bound:!1,root:n.target||f.$$.root};c&&c(p.root);let d=!1;if(p.ctx=l?l(t,n.props||{},((e,n,...r)=>{const o=r.length?r[0]:n;return p.ctx&&s(p.ctx[e],p.ctx[e]=o)&&(!p.skip_bound&&p.bound[e]&&p.bound[e](o),d&&fe(t,e)),n})):[],p.update(),d=!0,o(p.before_update),p.fragment=!!i&&i(p.ctx),n.target){if(n.hydrate){const e=function(e){return Array.from(e.childNodes)}(n.target);p.fragment&&p.fragment.l(e),e.forEach($)}else p.fragment&&p.fragment.c();n.intro&&re(t.$$.fragment),ce(t,n.target,n.anchor,n.customElement),X()}O(f)}class de{$destroy(){ue(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const ge=[];function he(t,n=e){let r;const o=new Set;function l(e){if(i(t,e)&&(t=e,r)){const e=!ge.length;for(const e of o)e[1](),ge.push(e,t);if(e){for(let e=0;e<ge.length;e+=2)ge[e][0](ge[e+1]);ge.length=0}}}return{set:l,update:function(e){l(e(t))},subscribe:function(i,s=e){const a=[i,s];return o.add(a),1===o.size&&(r=n(l)||e),i(t),()=>{o.delete(a),0===o.size&&(r(),r=null)}}}}const ve=he(!1),me=he("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR"),be=he(!1),xe=he(!1),ye=he(!1),$e=[{b:105023,w:115498,t:42,nxt:{e7e6:1,g8f6:1}},{b:15,w:115498,t:9263,nxt:{e7e6:1,g8f6:1,f7f5:9,b8a6:1,d8e7:2}},{b:105023,w:984984,t:66,nxt:{e7e6:1,g8f6:1}},{b:0,w:115498,t:9263,nxt:{e7e6:1,g8f6:1}}],we=function(t,n,r){const i=!Array.isArray(t),s=i?[t]:t,a=n.length<2;return u=t=>{let r=!1;const u=[];let f=0,p=e;const d=()=>{if(f)return;p();const r=n(i?u[0]:u,t);a?t(r):p=l(r)?r:e},g=s.map(((e,t)=>c(e,(e=>{u[t]=e,f&=~(1<<t),r&&d()}),(()=>{f|=1<<t}))));return r=!0,d(),function(){o(g),p()}},{subscribe:he(r,u).subscribe};var u}([me,ve],(([e,t])=>{if(!t)return $e;console.log("setting new fen",e,t);const n=["0","1","2","3"].map((n=>null==t[n][e]?[]:t[n][e]));return console.log("new fenDataStore vals",{vals:n}),n}),$e);var Me,Te,Ae=(Me=function(e,t){t.Chess=function(e){var t="b",n="w",r=-1,o="p",l="b",i="k",s="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",a=["1-0","0-1","1/2-1/2","*"],c={b:[16,32,17,15],w:[-16,-32,-17,-15]},u={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},f=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],p=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],d={p:0,n:1,b:2,r:3,q:4,k:5},g={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},h={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},v={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},m={w:[{square:v.a1,flag:h.QSIDE_CASTLE},{square:v.h1,flag:h.KSIDE_CASTLE}],b:[{square:v.a8,flag:h.QSIDE_CASTLE},{square:v.h8,flag:h.KSIDE_CASTLE}]},b=new Array(128),x={w:r,b:r},y=n,$={w:0,b:0},w=r,M=0,T=1,A=[],E={};function k(e){void 0===e&&(e=!1),b=new Array(128),x={w:r,b:r},y=n,$={w:0,b:0},w=r,M=0,T=1,A=[],e||(E={}),q(N())}function _(){C(s)}function C(e,o){void 0===o&&(o=!1);var l=e.split(/\s+/),i=l[0],s=0;if(!S(e).valid)return!1;k(o);for(var a=0;a<i.length;a++){var c=i.charAt(a);if("/"===c)s+=8;else if(-1!=="0123456789".indexOf(c))s+=parseInt(c,10);else{var u=c<"a"?n:t;L({type:c.toLowerCase(),color:u},Z(s)),s++}}return y=l[1],l[2].indexOf("K")>-1&&($.w|=h.KSIDE_CASTLE),l[2].indexOf("Q")>-1&&($.w|=h.QSIDE_CASTLE),l[2].indexOf("k")>-1&&($.b|=h.KSIDE_CASTLE),l[2].indexOf("q")>-1&&($.b|=h.QSIDE_CASTLE),w="-"===l[3]?r:v[l[3]],M=parseInt(l[4],10),T=parseInt(l[5],10),q(N()),!0}function S(e){var t="No errors.",n="FEN string must contain six space-delimited fields.",r="6th field (move number) must be a positive integer.",o="5th field (half move counter) must be a non-negative integer.",l="4th field (en-passant square) is invalid.",i="3rd field (castling availability) is invalid.",s="2nd field (side to move) is invalid.",a="1st field (piece positions) does not contain 8 '/'-delimited rows.",c="1st field (piece positions) is invalid [consecutive numbers].",u="1st field (piece positions) is invalid [invalid piece].",f="1st field (piece positions) is invalid [row too large].",p="Illegal en-passant square",d=e.split(/\s+/);if(6!==d.length)return{valid:!1,error_number:1,error:n};if(isNaN(d[5])||parseInt(d[5],10)<=0)return{valid:!1,error_number:2,error:r};if(isNaN(d[4])||parseInt(d[4],10)<0)return{valid:!1,error_number:3,error:o};if(!/^(-|[abcdefgh][36])$/.test(d[3]))return{valid:!1,error_number:4,error:l};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(d[2]))return{valid:!1,error_number:5,error:i};if(!/^(w|b)$/.test(d[1]))return{valid:!1,error_number:6,error:s};var g=d[0].split("/");if(8!==g.length)return{valid:!1,error_number:7,error:a};for(var h=0;h<g.length;h++){for(var v=0,m=!1,b=0;b<g[h].length;b++)if(isNaN(g[h][b])){if(!/^[prnbqkPRNBQK]$/.test(g[h][b]))return{valid:!1,error_number:9,error:u};v+=1,m=!1}else{if(m)return{valid:!1,error_number:8,error:c};v+=parseInt(g[h][b],10),m=!0}if(8!==v)return{valid:!1,error_number:10,error:f}}return"3"==d[3][1]&&"w"==d[1]||"6"==d[3][1]&&"b"==d[1]?{valid:!1,error_number:11,error:p}:{valid:!0,error_number:0,error:t}}function N(){for(var e=0,t="",o=v.a8;o<=v.h1;o++){if(null==b[o])e++;else{e>0&&(t+=e,e=0);var l=b[o].color,i=b[o].type;t+=l===n?i.toUpperCase():i.toLowerCase()}o+1&136&&(e>0&&(t+=e),o!==v.h1&&(t+="/"),e=0,o+=8)}var s="";$.w&h.KSIDE_CASTLE&&(s+="K"),$.w&h.QSIDE_CASTLE&&(s+="Q"),$.b&h.KSIDE_CASTLE&&(s+="k"),$.b&h.QSIDE_CASTLE&&(s+="q"),s=s||"-";var a=w===r?"-":Z(w);return[t,y,s,a,M,T].join(" ")}function P(e){for(var t=0;t<e.length;t+=2)"string"==typeof e[t]&&"string"==typeof e[t+1]&&(E[e[t]]=e[t+1]);return E}function q(e){A.length>0||(e!==s?(E.SetUp="1",E.FEN=e):(delete E.SetUp,delete E.FEN))}function I(e){var t=b[v[e]];return t?{type:t.type,color:t.color}:null}function L(e,t){if(!("type"in e)||!("color"in e))return!1;if(-1==="pnbrqkPNBRQK".indexOf(e.type.toLowerCase()))return!1;if(!(t in v))return!1;var n=v[t];return(e.type!=i||x[e.color]==r||x[e.color]==n)&&(b[n]={type:e.type,color:e.color},e.type===i&&(x[e.color]=n),q(N()),!0)}function D(e,t,n,r,l){var i={color:y,from:t,to:n,flags:r,piece:e[t].type};return l&&(i.flags|=h.PROMOTION,i.promotion=l),e[n]?i.captured=e[n].type:r&h.EP_CAPTURE&&(i.captured=o),i}function O(e){function t(e,t,n,r,i){if(e[n].type!==o||0!==X(r)&&7!==X(r))t.push(D(e,n,r,i));else for(var s=["q","r",l,"n"],a=0,c=s.length;a<c;a++)t.push(D(e,n,r,i,s[a]))}var n=[],r=y,i=J(r),s={b:1,w:6},a=v.a8,f=v.h1,p=!1,d=void 0===e||!("legal"in e)||e.legal;if(void 0!==e&&"square"in e){if(!(e.square in v))return[];a=f=v[e.square],p=!0}for(var g=a;g<=f;g++)if(136&g)g+=7;else{var m=b[g];if(null!=m&&m.color===r)if(m.type===o){var M=g+c[r][0];for(null==b[M]&&(t(b,n,g,M,h.NORMAL),M=g+c[r][1],s[r]===X(g)&&null==b[M]&&t(b,n,g,M,h.BIG_PAWN)),T=2;T<4;T++)136&(M=g+c[r][T])||(null!=b[M]&&b[M].color===i?t(b,n,g,M,h.CAPTURE):M===w&&t(b,n,g,w,h.EP_CAPTURE))}else for(var T=0,A=u[m.type].length;T<A;T++){var E=u[m.type][T];for(M=g;!(136&(M+=E));){if(null!=b[M]){if(b[M].color===r)break;t(b,n,g,M,h.CAPTURE);break}if(t(b,n,g,M,h.NORMAL),"n"===m.type||"k"===m.type)break}}}if(!p||f===x[r]){if($[r]&h.KSIDE_CASTLE){var k=(_=x[r])+2;null!=b[_+1]||null!=b[k]||B(i,x[r])||B(i,_+1)||B(i,k)||t(b,n,x[r],k,h.KSIDE_CASTLE)}var _;if($[r]&h.QSIDE_CASTLE)k=(_=x[r])-2,null!=b[_-1]||null!=b[_-2]||null!=b[_-3]||B(i,x[r])||B(i,_-1)||B(i,k)||t(b,n,x[r],k,h.QSIDE_CASTLE)}if(!d)return n;var C=[];for(g=0,A=n.length;g<A;g++)W(n[g]),K(r)||C.push(n[g]),H();return C}function R(e,t){var n="";if(e.flags&h.KSIDE_CASTLE)n="O-O";else if(e.flags&h.QSIDE_CASTLE)n="O-O-O";else{var r=function(e,t){for(var n=O({legal:!t}),r=e.from,o=e.to,l=e.piece,i=0,s=0,a=0,c=0,u=n.length;c<u;c++){var f=n[c].from,p=n[c].to;l===n[c].piece&&r!==f&&o===p&&(i++,X(r)===X(f)&&s++,Y(r)===Y(f)&&a++)}return i>0?s>0&&a>0?Z(r):a>0?Z(r).charAt(1):Z(r).charAt(0):""}(e,t);e.piece!==o&&(n+=e.piece.toUpperCase()+r),e.flags&(h.CAPTURE|h.EP_CAPTURE)&&(e.piece===o&&(n+=Z(e.from)[0]),n+="x"),n+=Z(e.to),e.flags&h.PROMOTION&&(n+="="+e.promotion.toUpperCase())}return W(e),Q()&&(z()?n+="#":n+="+"),H(),n}function j(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function B(e,r){for(var l=v.a8;l<=v.h1;l++)if(136&l)l+=7;else if(null!=b[l]&&b[l].color===e){var i=b[l],s=l-r,a=s+119;if(f[a]&1<<d[i.type]){if(i.type===o){if(s>0){if(i.color===n)return!0}else if(i.color===t)return!0;continue}if("n"===i.type||"k"===i.type)return!0;for(var c=p[a],u=l+c,g=!1;u!==r;){if(null!=b[u]){g=!0;break}u+=c}if(!g)return!0}}return!1}function K(e){return B(J(e),x[e])}function Q(){return K(y)}function z(){return Q()&&0===O().length}function F(){return!Q()&&0===O().length}function U(){for(var e={},t=[],n=0,r=0,o=v.a8;o<=v.h1;o++)if(r=(r+1)%2,136&o)o+=7;else{var i=b[o];i&&(e[i.type]=i.type in e?e[i.type]+1:1,i.type===l&&t.push(r),n++)}if(2===n)return!0;if(3===n&&(1===e.b||1===e.n))return!0;if(n===e.b+2){var s=0,a=t.length;for(o=0;o<a;o++)s+=t[o];if(0===s||s===a)return!0}return!1}function G(){for(var e=[],t={},n=!1;;){var r=H();if(!r)break;e.push(r)}for(;;){var o=N().split(" ").slice(0,4).join(" ");if(t[o]=o in t?t[o]+1:1,t[o]>=3&&(n=!0),!e.length)break;W(e.pop())}return n}function W(e){var n=y,l=J(n);if(function(e){A.push({move:e,kings:{b:x.b,w:x.w},turn:y,castling:{b:$.b,w:$.w},ep_square:w,half_moves:M,move_number:T})}(e),b[e.to]=b[e.from],b[e.from]=null,e.flags&h.EP_CAPTURE&&(y===t?b[e.to-16]=null:b[e.to+16]=null),e.flags&h.PROMOTION&&(b[e.to]={type:e.promotion,color:n}),b[e.to].type===i){if(x[b[e.to].color]=e.to,e.flags&h.KSIDE_CASTLE){var s=e.to-1,a=e.to+1;b[s]=b[a],b[a]=null}else e.flags&h.QSIDE_CASTLE&&(s=e.to+1,a=e.to-2,b[s]=b[a],b[a]=null);$[n]=""}if($[n])for(var c=0,u=m[n].length;c<u;c++)if(e.from===m[n][c].square&&$[n]&m[n][c].flag){$[n]^=m[n][c].flag;break}if($[l])for(c=0,u=m[l].length;c<u;c++)if(e.to===m[l][c].square&&$[l]&m[l][c].flag){$[l]^=m[l][c].flag;break}w=e.flags&h.BIG_PAWN?"b"===y?e.to-16:e.to+16:r,e.piece===o||e.flags&(h.CAPTURE|h.EP_CAPTURE)?M=0:M++,y===t&&T++,y=J(y)}function H(){var e=A.pop();if(null==e)return null;var n=e.move;x=e.kings,y=e.turn,$=e.castling,w=e.ep_square,M=e.half_moves,T=e.move_number;var r,l,i=y,s=J(y);if(b[n.from]=b[n.to],b[n.from].type=n.piece,b[n.to]=null,n.flags&h.CAPTURE)b[n.to]={type:n.captured,color:s};else if(n.flags&h.EP_CAPTURE){var a;a=i===t?n.to-16:n.to+16,b[a]={type:o,color:s}}return n.flags&(h.KSIDE_CASTLE|h.QSIDE_CASTLE)&&(n.flags&h.KSIDE_CASTLE?(r=n.to+1,l=n.to-1):n.flags&h.QSIDE_CASTLE&&(r=n.to-2,l=n.to+1),b[r]=b[l],b[l]=null),n}function V(e,t){var n=j(e);if(t){var r=n.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(r)var o=r[1],l=r[2],i=r[3],s=r[4]}for(var a=O(),c=0,u=a.length;c<u;c++){if(n===j(R(a[c]))||t&&n===j(R(a[c],!0)))return a[c];if(r&&(!o||o.toLowerCase()==a[c].piece)&&v[l]==a[c].from&&v[i]==a[c].to&&(!s||s.toLowerCase()==a[c].promotion))return a[c]}return null}function X(e){return e>>4}function Y(e){return 15&e}function Z(e){var t=Y(e),n=X(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(n,n+1)}function J(e){return e===n?t:n}function ee(e){var t=te(e);t.san=R(t,!1),t.to=Z(t.to),t.from=Z(t.from);var n="";for(var r in h)h[r]&t.flags&&(n+=g[r]);return t.flags=n,t}function te(e){var t=e instanceof Array?[]:{};for(var n in e)t[n]="object"==typeof n?te(e[n]):e[n];return t}function ne(e){return e.replace(/^\s+|\s+$/g,"")}function re(e){for(var t=O({legal:!1}),n=0,r=y,o=0,l=t.length;o<l;o++)W(t[o]),K(r)||(e-1>0?n+=re(e-1):n++),H();return n}return C(void 0===e?s:e),{WHITE:n,BLACK:t,PAWN:o,KNIGHT:"n",BISHOP:l,ROOK:"r",QUEEN:"q",KING:i,SQUARES:function(){for(var e=[],t=v.a8;t<=v.h1;t++)136&t?t+=7:e.push(Z(t));return e}(),FLAGS:g,load:function(e){return C(e)},reset:function(){return _()},moves:function(e){for(var t=O(e),n=[],r=0,o=t.length;r<o;r++)void 0!==e&&"verbose"in e&&e.verbose?n.push(ee(t[r])):n.push(R(t[r],!1));return n},in_check:function(){return Q()},in_checkmate:function(){return z()},in_stalemate:function(){return F()},in_draw:function(){return M>=100||F()||U()||G()},insufficient_material:function(){return U()},in_threefold_repetition:function(){return G()},game_over:function(){return M>=100||z()||F()||U()||G()},validate_fen:function(e){return S(e)},fen:function(){return N()},board:function(){for(var e=[],t=[],n=v.a8;n<=v.h1;n++)null==b[n]?t.push(null):t.push({type:b[n].type,color:b[n].color}),n+1&136&&(e.push(t),t=[],n+=8);return e},pgn:function(e){var t="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\n",n="object"==typeof e&&"number"==typeof e.max_width?e.max_width:0,r=[],o=!1;for(var l in E)r.push("["+l+' "'+E[l]+'"]'+t),o=!0;o&&A.length&&r.push(t);for(var i=[];A.length>0;)i.push(H());for(var s=[],a="";i.length>0;){var c=i.pop();A.length||"b"!==c.color?"w"===c.color&&(a.length&&s.push(a),a=T+"."):a=T+". ...",a=a+" "+R(c,!1),W(c)}if(a.length&&s.push(a),void 0!==E.Result&&s.push(E.Result),0===n)return r.join("")+s.join(" ");var u=0;for(l=0;l<s.length;l++)u+s[l].length>n&&0!==l?(" "===r[r.length-1]&&r.pop(),r.push(t),u=0):0!==l&&(r.push(" "),u++),r.push(s[l]),u+=s[l].length;return r.join("")},load_pgn:function(e,t){var n=void 0!==t&&"sloppy"in t&&t.sloppy;function r(e){return e.replace(/\\/g,"\\")}var o="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",l=new RegExp("^(\\[((?:"+r(o)+")|.)*\\])(?:"+r(o)+"){2}"),i=l.test(e)?l.exec(e)[1]:"";_();var s=function(e,t){for(var n="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",o={},l=e.split(new RegExp(r(n))),i="",s="",a=0;a<l.length;a++)i=l[a].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),s=l[a].replace(/^\[[A-Za-z]+\s"(.*)"\]$/,"$1"),ne(i).length>0&&(o[i]=s);return o}(i,t);for(var c in s)P([c,s[c]]);if(!("1"!==s.SetUp||"FEN"in s&&C(s.FEN,!0)))return!1;var u=e.replace(i,"").replace(new RegExp(r(o),"g")," ");u=u.replace(/(\{[^}]+\})+?/g,"");for(var f=/(\([^\(\)]+\))+?/g;f.test(u);)u=u.replace(f,"");var p=ne(u=(u=(u=u.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).split(new RegExp(/\s+/));p=p.join(",").replace(/,,+/g,",").split(",");for(var d="",g=0;g<p.length-1;g++){if(null==(d=V(p[g],n)))return!1;W(d)}if(d=p[p.length-1],a.indexOf(d)>-1)(function(e){for(var t in e)return!0;return!1})(E)&&void 0===E.Result&&P(["Result",d]);else{if(null==(d=V(d,n)))return!1;W(d)}return!0},header:function(){return P(arguments)},ascii:function(){return function(){for(var e="   +------------------------+\n",t=v.a8;t<=v.h1;t++){if(0===Y(t)&&(e+=" "+"87654321"[X(t)]+" |"),null==b[t])e+=" . ";else{var r=b[t].type;e+=" "+(b[t].color===n?r.toUpperCase():r.toLowerCase())+" "}t+1&136&&(e+="|\n",t+=8)}return(e+="   +------------------------+\n")+"     a  b  c  d  e  f  g  h\n"}()},turn:function(){return y},move:function(e,t){var n=void 0!==t&&"sloppy"in t&&t.sloppy,r=null;if("string"==typeof e)r=V(e,n);else if("object"==typeof e)for(var o=O(),l=0,i=o.length;l<i;l++)if(e.from===Z(o[l].from)&&e.to===Z(o[l].to)&&(!("promotion"in o[l])||e.promotion===o[l].promotion)){r=o[l];break}if(!r)return null;var s=ee(r);return W(r),s},undo:function(){var e=H();return e?ee(e):null},clear:function(){return k()},put:function(e,t){return L(e,t)},get:function(e){return I(e)},remove:function(e){return function(e){var t=I(e);return b[v[e]]=null,t&&t.type===i&&(x[t.color]=r),q(N()),t}(e)},perft:function(e){return re(e)},square_color:function(e){if(e in v){var t=v[e];return(X(t)+Y(t))%2==0?"light":"dark"}return null},history:function(e){for(var t=[],n=[],r=(void 0!==e&&"verbose"in e&&e.verbose);A.length>0;)t.push(H());for(;t.length>0;){var o=t.pop();r?n.push(ee(o)):n.push(R(o)),W(o)}return n}}}},Me(Te={exports:{}},Te.exports),Te.exports);const{document:Ee}=se;function ke(e){let t;return{c(){t=M("div"),t.innerHTML='<h3 style="color:red">There was an error rendering the chessboard, please reload the page...</h3>',N(t,"width","400px"),N(t,"height","400px")},m(e,n){y(e,t,n)},d(e){e&&$(t)}}}function _e(t){let n,r,l,i,s,c,u,f,p,d,g,h,v,b,x,w,T,k,S,P,q,I,L,D,O,R,j,B,K,Q,z,F,U=null==t[0]&&ke();return{c(){n=M("script"),l=M("link"),i=M("script"),c=E(),u=M("div"),U&&U.c(),f=E(),p=M("div"),p.innerHTML='<p id="who-plays"></p>',d=E(),g=M("div"),h=E(),v=M("div"),b=M("button"),b.textContent="Back",x=E(),w=M("button"),w.textContent="Start Position",T=E(),k=M("div"),S=M("input"),P=E(),q=M("button"),q.textContent="Copy Position",I=E(),L=M("div"),D=M("input"),O=E(),R=M("button"),R.textContent="Set Position",j=E(),B=M("label"),K=M("input"),Q=A("  Only Legal Moves"),a(n.src,r="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js")||C(n,"src","https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"),C(l,"rel","stylesheet"),C(l,"href","./chessboard-1.0.0.min.css"),a(i.src,s="./chessboard-1.0.0.min.js")||C(i,"src","./chessboard-1.0.0.min.js"),C(g,"id","board"),N(g,"width","400px"),C(b,"id","backBtn"),C(b,"class","svelte-k6csfm"),C(w,"id","startBtn"),C(w,"class","svelte-k6csfm"),C(v,"class","btn-div svelte-k6csfm"),C(S,"type","text"),S.value="",C(S,"id","copy-fen"),C(S,"class","svelte-k6csfm"),N(q,"width","160px"),C(k,"id","fen-copy-div"),C(k,"class","svelte-k6csfm"),C(D,"type","text"),D.value="",C(D,"id","get-fen"),C(D,"class","svelte-k6csfm"),C(R,"id","get-fen-btn"),C(R,"class","svelte-k6csfm"),C(L,"id","fen-get-div"),C(L,"class","svelte-k6csfm"),C(K,"type","checkbox"),C(K,"id","legal"),C(K,"name","legal"),K.value="yes",C(B,"for","legal"),C(u,"class","container svelte-k6csfm")},m(e,r){m(Ee.head,n),m(Ee.head,l),m(Ee.head,i),y(e,c,r),y(e,u,r),U&&U.m(u,null),m(u,f),m(u,p),m(u,d),m(u,g),m(u,h),m(u,v),m(v,b),m(v,x),m(v,w),m(u,T),m(u,k),m(k,S),m(k,P),m(k,q),m(u,I),m(u,L),m(L,D),m(L,O),m(L,R),m(u,j),m(u,B),m(B,K),m(B,Q),z||(F=[_(i,"load",t[1]),_(b,"click",t[4]),_(w,"click",t[1]),_(q,"click",Ie),_(R,"click",t[2]),_(K,"click",t[3])],z=!0)},p(e,[t]){null==e[0]?U||(U=ke(),U.c(),U.m(u,f)):U&&(U.d(1),U=null)},i:e,o:e,d(e){$(n),$(l),$(i),e&&$(c),e&&$(u),U&&U.d(),z=!1,o(F)}}}let Ce="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR";function Se(e,t){}function Ne(e){var t=document.querySelector("#board .square-"+e),n="#a9a9a9";t.getAttribute("class").includes("black-3c85d")&&(n="#696969"),t.style.background=n}function Pe(e,t){qe()}function qe(){for(var e=document.querySelectorAll("#board .square-55d63"),t=0;t<e.length;t++)e[t].style.background=""}function Ie(){var e=document.querySelector("#copy-fen");e.select(),e.setSelectionRange(0,99999),navigator.clipboard.writeText(e.value)}function Le(e,t,n){var r;let o;var l,i=!0;j(be.subscribe((e=>{console.log("Here",e);var t=document.querySelector("#board .square-"+e),n=document.createElement("div");null!=t?(n.setAttribute("class","sq_div"),n.style.height="80%",n.style.border="5px solid #0000FF",t.appendChild(n)):null!=(n=document.querySelector(".sq_div"))&&n.remove()})));j(me.subscribe((e=>{e!=o&&r&&r.position(e)})));function s(){l=new Ae.Chess,n(0,r=Chessboard("board",{draggable:!0,position:"start",onDrop:a,onChange:c,onDragStart:Se,onMouseoverSquare:u,onMouseoutSquare:Pe,sparePieces:!1,dropOffBoard:1==i?"snapback":"trash"})),o=r.fen(),f(),me.set(o),d()}function a(e,t,n,o,s,a){if(Chessboard.objToFen(s)==Chessboard.objToFen(o))return!1;qe();var c=l.move({from:e,to:t,promotion:"q"});if(i){if(console.log("Move: ",c),null===c)return"snapback";"O-O"==c.san&&("w"==c.color?r.move("h1-f1"):"b"==c.color&&r.move("h8-f8")),"O-O-O"==c.san&&("w"==c.color?r.move("a1-d1"):"b"==c.color&&r.move("a8-d8"))}}function c(e,t){console.log("On Change",Chessboard.objToFen(t)),o=Chessboard.objToFen(t),f(),console.log("Turn to Play: ",l.turn()),me.set(o),me.subscribe((e=>{console.log("After Change, Current Fen: ",e)})),p(i),d()}function u(e,t){var n=l.moves({square:e,verbose:!0});Ne(e);for(var r=0;r<n.length;r++)Ne(n[r].to)}function f(){var e=document.querySelector("#copy-fen");e.value=null==o?Ce:o}function p(e){const t=document.createElement("h1");var n,r=document.querySelector("#who-plays");0==e?(r.innerHTML="",n=document.createTextNode("Move pieces to update the visualization.")):1==e&&(r.innerHTML="",n=document.createTextNode("Move of: "+("w"==l.turn()?"White":"Black"))),t.appendChild(n),r.appendChild(t)}function d(){ye.set(l.moves({verbose:!0}))}return j(ye.subscribe((e=>{console.log("Legal Moves: ",e)}))),function(e){R().$$.on_mount.push(e)}((()=>{console.log("Mounted"),console.log("Curr_fen",me,"start"),f(),p(!1)})),[r,s,function(){console.log("In getBoardPos()");var e=document.querySelector("#get-fen");let t=e.value;""==t&&r.clear(!0),r.position(t,!0),e.value=""},function(){var e=document.querySelector("#legal");console.log("LegalChechBox: ",e.checked),i=e.checked,s(),p(i)},function(){o==Ce&&0==l.history().length?alert("No Moves played previously"):(l.undo(),r.position(l.fen(),!0))}]}class De extends de{constructor(e){super(),pe(this,e,Le,_e,i,{})}}function Oe(t){let n;return{c(){n=M("div"),n.innerHTML='<h1 class="svelte-1iwn6yh">Chessboard Visualization:\n        A project for CS549 Visual Analytics</h1> \n    <a href="https://learningchess.net/us/app/jsLesson.php"><button class="svelte-1iwn6yh">What is &quot;e4&quot;?? Learn chess here</button></a>',C(n,"class","container svelte-1iwn6yh")},m(e,t){y(e,n,t)},p:e,i:e,o:e,d(e){e&&$(n)}}}class Re extends de{constructor(e){super(),pe(this,e,null,Oe,i,{})}}function je(e){let t,n;return{c(){t=M("div"),n=A(e[0]),N(t,"top",e[3]+"px"),N(t,"left",e[2]+"px"),C(t,"class","tooltip svelte-ehxw5s")},m(e,r){y(e,t,r),m(t,n)},p(e,r){1&r&&S(n,e[0]),8&r&&N(t,"top",e[3]+"px"),4&r&&N(t,"left",e[2]+"px")},d(e){e&&$(t)}}}function Be(e){let t,n,r,l,i,s;const a=e[8].default,c=function(e,t,n,r){if(e){const o=f(e,t,n,r);return e[0](o)}}(a,e,e[7],null);let u=e[1]&&je(e);return{c(){t=M("div"),c&&c.c(),n=E(),u&&u.c(),r=k()},m(o,a){y(o,t,a),c&&c.m(t,null),y(o,n,a),u&&u.m(o,a),y(o,r,a),l=!0,i||(s=[_(t,"mouseover",e[4]),_(t,"mouseleave",e[6]),_(t,"mousemove",e[5])],i=!0)},p(e,[t]){c&&c.p&&(!l||128&t)&&function(e,t,n,r,o,l){if(o){const i=f(t,n,r,l);e.p(i,o)}}(c,a,e,e[7],l?function(e,t,n,r){if(e[2]&&r){const o=e[2](r(n));if(void 0===t.dirty)return o;if("object"==typeof o){const e=[],n=Math.max(t.dirty.length,o.length);for(let r=0;r<n;r+=1)e[r]=t.dirty[r]|o[r];return e}return t.dirty|o}return t.dirty}(a,e[7],t,null):function(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}(e[7]),null),e[1]?u?u.p(e,t):(u=je(e),u.c(),u.m(r.parentNode,r)):u&&(u.d(1),u=null)},i(e){l||(re(c,e),l=!0)},o(e){oe(c,e),l=!1},d(e){e&&$(t),c&&c.d(e),e&&$(n),u&&u.d(e),e&&$(r),i=!1,o(s)}}}function Ke(e,t,n){let r,o,{$$slots:l={},$$scope:i}=t,{title:s=""}=t,a=!1;return e.$$set=e=>{"title"in e&&n(0,s=e.title),"$$scope"in e&&n(7,i=e.$$scope)},[s,a,r,o,function(e){n(1,a=!0),n(2,r=e.pageX+5),n(3,o=e.pageY+5)},function(e){n(2,r=e.pageX+5),n(3,o=e.pageY+5)},function(){n(1,a=!1)},i,l]}class Qe extends de{constructor(e){super(),pe(this,e,Ke,Be,i,{title:0})}}function ze(e){return e<.5?4*e*e*e:.5*Math.pow(2*e-2,3)+1}function Fe(e,{delay:t=0,speed:n,duration:r,easing:o=ze}={}){let l=e.getTotalLength();const i=getComputedStyle(e);return"butt"!==i.strokeLinecap&&(l+=parseInt(i.strokeWidth)),void 0===r?r=void 0===n?800:l/n:"function"==typeof r&&(r=r(l)),{delay:t,duration:r,easing:o,css:(e,t)=>`stroke-dasharray: ${e*l} ${t*l}`}}function Ue(e,t,n){const r=e.slice();return r[3]=t[n],r[5]=n,r}function Ge(e,t,n){const r=e.slice();return r[3]=t[n],r[5]=n,r}function We(t){let n;return{c(){n=M("p"),n.textContent="No games found"},m(e,t){y(e,n,t)},p:e,d(e){e&&$(n)}}}function He(e){let t,n,r,o=0!=e[3].b&&Ve(e),l=0!=e[3].t&&Xe(e),i=0!=e[3].w&&Ye(e);return{c(){o&&o.c(),t=E(),l&&l.c(),n=E(),i&&i.c(),r=k()},m(e,s){o&&o.m(e,s),y(e,t,s),l&&l.m(e,s),y(e,n,s),i&&i.m(e,s),y(e,r,s)},p(e,s){0!=e[3].b?o?o.p(e,s):(o=Ve(e),o.c(),o.m(t.parentNode,t)):o&&(o.d(1),o=null),0!=e[3].t?l?l.p(e,s):(l=Xe(e),l.c(),l.m(n.parentNode,n)):l&&(l.d(1),l=null),0!=e[3].w?i?i.p(e,s):(i=Ye(e),i.c(),i.m(r.parentNode,r)):i&&(i.d(1),i=null)},d(e){o&&o.d(e),e&&$(t),l&&l.d(e),e&&$(n),i&&i.d(e),e&&$(r)}}}function Ve(e){let t,n,r,o=e[3].b+"";return{c(){t=M("div"),n=A(o),r=A("%"),C(t,"class","bar val-a svelte-xyr3o0"),N(t,"flex-basis",e[3].b+"%")},m(e,o){y(e,t,o),m(t,n),m(t,r)},p(e,r){1&r&&o!==(o=e[3].b+"")&&S(n,o),1&r&&N(t,"flex-basis",e[3].b+"%")},d(e){e&&$(t)}}}function Xe(e){let t,n,r,o=e[3].t+"";return{c(){t=M("div"),n=A(o),r=A("%"),C(t,"class","bar val-b svelte-xyr3o0"),N(t,"flex-basis",e[3].t+"%")},m(e,o){y(e,t,o),m(t,n),m(t,r)},p(e,r){1&r&&o!==(o=e[3].t+"")&&S(n,o),1&r&&N(t,"flex-basis",e[3].t+"%")},d(e){e&&$(t)}}}function Ye(e){let t,n,r,o=e[3].w+"";return{c(){t=M("div"),n=A(o),r=A("%"),C(t,"class","bar val-c svelte-xyr3o0"),N(t,"flex-basis",e[3].w+"%")},m(e,o){y(e,t,o),m(t,n),m(t,r)},p(e,r){1&r&&o!==(o=e[3].w+"")&&S(n,o),1&r&&N(t,"flex-basis",e[3].w+"%")},d(e){e&&$(t)}}}function Ze(e){let t,n,r,o,l,i,s,a=e[1][e[5]]+"";function c(e,t){return e[3].b+e[3].t+e[3].w!=0?He:We}let u=c(e),f=u(e);return{c(){t=M("div"),n=M("div"),r=M("p"),o=A(a),l=E(),i=M("div"),f.c(),s=E(),C(r,"text-align","right"),C(n,"class","label svelte-xyr3o0"),C(i,"class","bar-container svelte-xyr3o0"),C(i,"id","results-by-exp-bars"),C(t,"class","row svelte-xyr3o0")},m(e,a){y(e,t,a),m(t,n),m(n,r),m(r,o),m(t,l),m(t,i),f.m(i,null),y(e,s,a)},p(e,t){u===(u=c(e))&&f?f.p(e,t):(f.d(1),f=u(e),f&&(f.c(),f.m(i,null)))},d(e){e&&$(t),f.d(),e&&$(s)}}}function Je(e){let t,n;return t=new Qe({props:{title:"Game counts for "+(e[1][e[5]]||0)+": \r\n\r\n              Black- "+(e[3].bG||0)+"\r\n              Tie- "+(e[3].tG||0)+"\r\n              White- "+(e[3].wG||0)+" ",$$slots:{default:[Ze]},$$scope:{ctx:e}}}),{c(){ae(t.$$.fragment)},m(e,r){ce(t,e,r),n=!0},p(e,n){const r={};1&n&&(r.title="Game counts for "+(e[1][e[5]]||0)+": \r\n\r\n              Black- "+(e[3].bG||0)+"\r\n              Tie- "+(e[3].tG||0)+"\r\n              White- "+(e[3].wG||0)+" "),129&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(re(t.$$.fragment,e),n=!0)},o(e){oe(t.$$.fragment,e),n=!1},d(e){ue(t,e)}}}function et(t){let n;return{c(){n=M("p"),n.textContent="No games found"},m(e,t){y(e,n,t)},p:e,d(e){e&&$(n)}}}function tt(e){let t,n,r,o=(e[3].popularity||0)+"";return{c(){t=M("div"),n=A(o),r=A("%"),C(t,"class","bar val-"+[e[5]]+" svelte-xyr3o0"),N(t,"flex-basis",(Math.round(e[3].popularity/Math.max(...e[0].map(lt))*100)||0)+"%")},m(e,o){y(e,t,o),m(t,n),m(t,r)},p(e,r){1&r&&o!==(o=(e[3].popularity||0)+"")&&S(n,o),1&r&&N(t,"flex-basis",(Math.round(e[3].popularity/Math.max(...e[0].map(lt))*100)||0)+"%")},d(e){e&&$(t)}}}function nt(e){let t,n,r,o,l,i,s,a=e[1][e[5]]+"";function c(e,t){return 0!=e[0][e[5]].total?tt:et}let u=c(e),f=u(e);return{c(){t=M("div"),n=M("div"),r=M("p"),o=A(a),l=E(),i=M("div"),f.c(),s=E(),C(r,"text-align","right"),C(n,"class","label svelte-xyr3o0"),C(i,"class","bar-container svelte-xyr3o0"),C(t,"class","row svelte-xyr3o0")},m(e,a){y(e,t,a),m(t,n),m(n,r),m(r,o),m(t,l),m(t,i),f.m(i,null),y(e,s,a)},p(e,t){u===(u=c(e))&&f?f.p(e,t):(f.d(1),f=u(e),f&&(f.c(),f.m(i,null)))},d(e){e&&$(t),f.d(),e&&$(s)}}}function rt(e){let t,n;return t=new Qe({props:{title:"      Game counts: \r\n\r\n      Beginner- "+(e[0][0].total||0)+"\r\n      Intermediate- "+(e[0][1].total||0)+"\r\n      Advanced- "+(e[0][2].total||0)+"\r\n      Pro- "+(e[0][3].total||0),$$slots:{default:[nt]},$$scope:{ctx:e}}}),{c(){ae(t.$$.fragment)},m(e,r){ce(t,e,r),n=!0},p(e,n){const r={};1&n&&(r.title="      Game counts: \r\n\r\n      Beginner- "+(e[0][0].total||0)+"\r\n      Intermediate- "+(e[0][1].total||0)+"\r\n      Advanced- "+(e[0][2].total||0)+"\r\n      Pro- "+(e[0][3].total||0)),129&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(re(t.$$.fragment,e),n=!0)},o(e){oe(t.$$.fragment,e),n=!1},d(e){ue(t,e)}}}function ot(e){let t,n,r,o,l,i,s,a,c,u,f,p,d,g=e[0],h=[];for(let t=0;t<g.length;t+=1)h[t]=Je(Ge(e,g,t));const v=e=>oe(h[e],1,1,(()=>{h[e]=null}));let b=e[0],x=[];for(let t=0;t<b.length;t+=1)x[t]=rt(Ue(e,b,t));const T=e=>oe(x[e],1,1,(()=>{x[e]=null}));return{c(){t=M("div"),n=M("h1"),n.textContent="Game Results by Experience Level",r=E(),o=M("h3"),o.textContent="Eventual outcome for games that reach this position",l=E(),i=M("div");for(let e=0;e<h.length;e+=1)h[e].c();s=E(),a=M("h1"),a.textContent="Position Popularity by Experience Level",c=E(),u=M("h3"),u.textContent="% of games that reach this position",f=E(),p=M("div");for(let e=0;e<x.length;e+=1)x[e].c();C(i,"class","container1 svelte-xyr3o0"),C(a,"align","center"),C(a,"font-size","28"),C(p,"class","container1 svelte-xyr3o0"),C(t,"align","center"),C(t,"class","container svelte-xyr3o0")},m(e,g){y(e,t,g),m(t,n),m(t,r),m(t,o),m(t,l),m(t,i);for(let e=0;e<h.length;e+=1)h[e].m(i,null);m(t,s),m(t,a),m(t,c),m(t,u),m(t,f),m(t,p);for(let e=0;e<x.length;e+=1)x[e].m(p,null);d=!0},p(e,[t]){if(3&t){let n;for(g=e[0],n=0;n<g.length;n+=1){const r=Ge(e,g,n);h[n]?(h[n].p(r,t),re(h[n],1)):(h[n]=Je(r),h[n].c(),re(h[n],1),h[n].m(i,null))}for(te(),n=g.length;n<h.length;n+=1)v(n);ne()}if(3&t){let n;for(b=e[0],n=0;n<b.length;n+=1){const r=Ue(e,b,n);x[n]?(x[n].p(r,t),re(x[n],1)):(x[n]=rt(r),x[n].c(),re(x[n],1),x[n].m(p,null))}for(te(),n=b.length;n<x.length;n+=1)T(n);ne()}},i(e){if(!d){for(let e=0;e<g.length;e+=1)re(h[e]);for(let e=0;e<b.length;e+=1)re(x[e]);d=!0}},o(e){h=h.filter(Boolean);for(let e=0;e<h.length;e+=1)oe(h[e]);x=x.filter(Boolean);for(let e=0;e<x.length;e+=1)oe(x[e]);d=!1},d(e){e&&$(t),w(h,e),w(x,e)}}}const lt=e=>e.popularity;function it(e,t,n){let r=[];return j(we.subscribe((e=>{let t=[161763,700261,444771,88547];n(0,r=e.map(((e,n)=>{let r=[e.b,e.t,e.w],o=e.b+e.w+e.t,l=(o/t[n]*100).toFixed(2)||0;return{g:r,bG:e.b||0,b:Math.round(e.b/o*100)||0,wG:e.w||0,w:Math.round(e.w/o*100)||0,tG:e.t||0,t:Math.round(e.t/o*100)||0,total:o||0,popularity:l||0,gameTotal:t||0}})))}))),console.table({posData:r}),[r,["Beginner","Intermediate","Advanced","Pro"]]}class st extends de{constructor(e){super(),pe(this,e,it,ot,i,{})}}const at={B:"#ffffb3",N:"#bebada",Q:"#fb8072",R:"#80b1d3",K:"#fdb462"},ct=[["Bishop","#ffffb3"],["Knight","#bebada"],["Queen","#fb8072"],["Rook","#80b1d3"],["King","#fdb462"],["Pawn","#b3de69"]];function ut({i:e,san:t}){return t?function(e){return at[e[0]]||"#b3de69"}(t):function(e){const t=["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffed6f"];return t[e%t.length]}(e)}function ft(e){let t,n,r;return{c(){t=T("text"),n=A(e[5]),C(t,"transform",r="translate(18,"+((e[6]-e[7]+e[7]/2)*e[9]/e[4]+5)+")")},m(e,r){y(e,t,r),m(t,n)},p(e,o){32&o&&S(n,e[5]),208&o&&r!==(r="translate(18,"+((e[6]-e[7]+e[7]/2)*e[9]/e[4]+5)+")")&&C(t,"transform",r)},d(e){e&&$(t)}}}function pt(t){let n,r,i,s,a,c,u,f,p,d=t[7]/t[4]*t[9]>20&&ft(t);return{c(){n=T("g"),r=T("rect"),d&&d.c(),C(r,"width",t[10]),C(r,"height",i=t[7]/t[4]*t[9]),C(r,"transform",s="translate(0,"+(t[6]-t[7])/t[4]*t[9]+")"),C(r,"fill",a=t[8]?ut({san:t[5]}):ut({i:t[0]})),C(r,"stroke",c=t[8]?"black":void 0),C(n,"id",u=`bar-${t[5]}`),C(n,"class","bar svelte-q2qqok")},m(e,o){y(e,n,o),m(n,r),d&&d.m(n,null),f||(p=[_(n,"mouseenter",t[13]),_(n,"mouseleave",(function(){l(t[2])&&t[2].apply(this,arguments)})),_(n,"click",t[11])],f=!0)},p(e,[o]){t=e,144&o&&i!==(i=t[7]/t[4]*t[9])&&C(r,"height",i),208&o&&s!==(s="translate(0,"+(t[6]-t[7])/t[4]*t[9]+")")&&C(r,"transform",s),289&o&&a!==(a=t[8]?ut({san:t[5]}):ut({i:t[0]}))&&C(r,"fill",a),256&o&&c!==(c=t[8]?"black":void 0)&&C(r,"stroke",c),t[7]/t[4]*t[9]>20?d?d.p(t,o):(d=ft(t),d.c(),d.m(n,null)):d&&(d.d(1),d=null),32&o&&u!==(u=`bar-${t[5]}`)&&C(n,"id",u)},i:e,o:e,d(e){e&&$(n),d&&d.d(),f=!1,o(p)}}}function dt(e,t,n){let r,o,l,i,s;u(e,xe,(e=>n(8,s=e)));let{i:a}=t,{data:c}=t,{hideTooltip:f,showTooltip:p}=t,{nextMovesTotal:d}=t,{sizing:g}=t,h=!0;const v=setInterval((()=>h=!h),500);j((()=>clearInterval(v)));const{w:m,h:b,bw:x}=g;return e.$$set=e=>{"i"in e&&n(0,a=e.i),"data"in e&&n(1,c=e.data),"hideTooltip"in e&&n(2,f=e.hideTooltip),"showTooltip"in e&&n(3,p=e.showTooltip),"nextMovesTotal"in e&&n(4,d=e.nextMovesTotal),"sizing"in e&&n(12,g=e.sizing)},e.$$.update=()=>{2&e.$$.dirty&&n(7,({fen:r,count:o,accCount:l,san:i}=c),o,(n(6,l),n(1,c)),(n(5,i),n(1,c)))},[a,c,f,p,d,i,l,o,s,b,x,function(){me.set(r),f()},g,e=>p(e,c)]}class gt extends de{constructor(e){super(),pe(this,e,dt,pt,i,{i:0,data:1,hideTooltip:2,showTooltip:3,nextMovesTotal:4,sizing:12})}}function ht(e,t,n){const r=e.slice();return r[27]=t[n],r[29]=n,r}function vt(e){let t,n,r,o,l,i;return{c(){t=T("path"),C(t,"d",n=`M${e[27].x1},${e[27].y1} C0${e[2]},${e[27].y1} 0,${e[27].y2} ${e[27].x2},${e[27].y2}`),C(t,"fill","none"),C(t,"stroke",r=e[3](e[27])),C(t,"stroke-width",o=e[27].t)},m(e,n){y(e,t,n),i=!0},p(l,s){e=l,(!i||1&s&&n!==(n=`M${e[27].x1},${e[27].y1} C0${e[2]},${e[27].y1} 0,${e[27].y2} ${e[27].x2},${e[27].y2}`))&&C(t,"d",n),(!i||1&s&&r!==(r=e[3](e[27])))&&C(t,"stroke",r),(!i||1&s&&o!==(o=e[27].t))&&C(t,"stroke-width",o)},i(n){i||(G((()=>{l||(l=ie(t,Fe,{duration:300,delay:100*(e[0].length-e[29])},!0)),l.run(1)})),i=!0)},o(n){l||(l=ie(t,Fe,{duration:300,delay:100*(e[0].length-e[29])},!1)),l.run(0),i=!1},d(e){e&&$(t),e&&l&&l.end()}}}function mt(e){let t,n,r,o=e[0].reverse(),l=[];for(let t=0;t<o.length;t+=1)l[t]=vt(ht(e,o,t));const i=e=>oe(l[e],1,1,(()=>{l[e]=null}));return{c(){t=T("g");for(let e=0;e<l.length;e+=1)l[e].c();C(t,"id",n=`bar-${e[1]}`),C(t,"class","bar svelte-1uesnla")},m(e,n){y(e,t,n);for(let e=0;e<l.length;e+=1)l[e].m(t,null);r=!0},p(e,[s]){if(13&s){let n;for(o=e[0].reverse(),n=0;n<o.length;n+=1){const r=ht(e,o,n);l[n]?(l[n].p(r,s),re(l[n],1)):(l[n]=vt(r),l[n].c(),re(l[n],1),l[n].m(t,null))}for(te(),n=o.length;n<l.length;n+=1)i(n);ne()}(!r||2&s&&n!==(n=`bar-${e[1]}`))&&C(t,"id",n)},i(e){if(!r){for(let e=0;e<o.length;e+=1)re(l[e]);r=!0}},o(e){l=l.filter(Boolean);for(let e=0;e<l.length;e+=1)oe(l[e]);r=!1},d(e){e&&$(t),w(l,e)}}}function bt(e,t,n){let r,o,l,i,s,a,c;u(e,xe,(e=>n(18,c=e)));let{tooltipData:f}=t,{nextMovesTotal:p}=t,{aggNextMove:d}=t,{nextMovesArr:g}=t,{nextMovesTotal2:h}=t,{aggNextMove2:v}=t,{nextMovesArr2:m}=t,{sizing:b}=t;const{w:x,h:y,bw:$,th:w}=b;return e.$$set=e=>{"tooltipData"in e&&n(4,f=e.tooltipData),"nextMovesTotal"in e&&n(5,p=e.nextMovesTotal),"aggNextMove"in e&&n(6,d=e.aggNextMove),"nextMovesArr"in e&&n(7,g=e.nextMovesArr),"nextMovesTotal2"in e&&n(8,h=e.nextMovesTotal2),"aggNextMove2"in e&&n(9,v=e.aggNextMove2),"nextMovesArr2"in e&&n(10,m=e.nextMovesArr2),"sizing"in e&&n(11,b=e.sizing)},e.$$.update=()=>{16&e.$$.dirty&&n(1,({san:r,count:o,fen:l,accCount:i,curves:s}=f),r,(n(13,o),n(4,f)),(n(14,i),n(4,f)),(n(12,s),n(4,f))),e.$$.dirty,e.$$.dirty,4096&e.$$.dirty&&n(0,a=s)},[a,r,x,function(e){return e.c?e.c:ut(c?{san:e.san}:{i:e.i})},f,p,d,g,h,v,m,b,s,o,i]}class xt extends de{constructor(e){super(),pe(this,e,bt,mt,i,{tooltipData:4,nextMovesTotal:5,aggNextMove:6,nextMovesArr:7,nextMovesTotal2:8,aggNextMove2:9,nextMovesArr2:10,sizing:11})}}function yt(e,t,n){const r=e.slice();return r[18]=t[n],r[20]=n,r}function $t(e,t,n){const r=e.slice();return r[18]=t[n],r[20]=n,r}function wt(t){let n,r;return{c(){n=T("text"),r=A("No games found"),C(n,"transform","translate(30,20)"),C(n,"class","svelte-lhg3t6")},m(e,t){y(e,n,t),m(n,r)},p:e,i:e,o:e,d(e){e&&$(n)}}}function Mt(e){let t,n,r=e[1],o=[];for(let t=0;t<r.length;t+=1)o[t]=Tt($t(e,r,t));const l=e=>oe(o[e],1,1,(()=>{o[e]=null}));return{c(){for(let e=0;e<o.length;e+=1)o[e].c();t=k()},m(e,r){for(let t=0;t<o.length;t+=1)o[t].m(e,r);y(e,t,r),n=!0},p(e,n){if(7174&n){let i;for(r=e[1],i=0;i<r.length;i+=1){const l=$t(e,r,i);o[i]?(o[i].p(l,n),re(o[i],1)):(o[i]=Tt(l),o[i].c(),re(o[i],1),o[i].m(t.parentNode,t))}for(te(),i=r.length;i<o.length;i+=1)l(i);ne()}},i(e){if(!n){for(let e=0;e<r.length;e+=1)re(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)oe(o[e]);n=!1},d(e){w(o,e),e&&$(t)}}}function Tt(e){let t,n;return t=new gt({props:{data:e[18],i:e[20],sizing:e[12],nextMovesTotal:e[2],hideTooltip:e[11],showTooltip:e[10]}}),{c(){ae(t.$$.fragment)},m(e,r){ce(t,e,r),n=!0},p(e,n){const r={};2&n&&(r.data=e[18]),4&n&&(r.nextMovesTotal=e[2]),t.$set(r)},i(e){n||(re(t.$$.fragment,e),n=!0)},o(e){oe(t.$$.fragment,e),n=!1},d(e){ue(t,e)}}}function At(t){let n,r;return{c(){n=T("text"),r=A("No games found"),C(n,"transform","translate(-60,20)"),C(n,"class","svelte-lhg3t6")},m(e,t){y(e,n,t),m(n,r)},p:e,i:e,o:e,d(e){e&&$(n)}}}function Et(e){let t,n,r=e[4],o=[];for(let t=0;t<r.length;t+=1)o[t]=kt(yt(e,r,t));const l=e=>oe(o[e],1,1,(()=>{o[e]=null}));return{c(){for(let e=0;e<o.length;e+=1)o[e].c();t=k()},m(e,r){for(let t=0;t<o.length;t+=1)o[t].m(e,r);y(e,t,r),n=!0},p(e,n){if(7216&n){let i;for(r=e[4],i=0;i<r.length;i+=1){const l=yt(e,r,i);o[i]?(o[i].p(l,n),re(o[i],1)):(o[i]=kt(l),o[i].c(),re(o[i],1),o[i].m(t.parentNode,t))}for(te(),i=r.length;i<o.length;i+=1)l(i);ne()}},i(e){if(!n){for(let e=0;e<r.length;e+=1)re(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)oe(o[e]);n=!1},d(e){w(o,e),e&&$(t)}}}function kt(e){let t,n;return t=new gt({props:{data:e[18],i:e[20],sizing:e[12],nextMovesTotal:e[5],hideTooltip:e[11],showTooltip:e[10]}}),{c(){ae(t.$$.fragment)},m(e,r){ce(t,e,r),n=!0},p(e,n){const r={};16&n&&(r.data=e[18]),32&n&&(r.nextMovesTotal=e[5]),t.$set(r)},i(e){n||(re(t.$$.fragment,e),n=!0)},o(e){oe(t.$$.fragment,e),n=!1},d(e){ue(t,e)}}}function _t(e){let t,n,r,o,l,i;return t=new xt({props:{sizing:e[12],tooltipData:e[9],aggNextMove:e[0],nextMovesArr:e[1],nextMovesTotal:e[2],aggNextMove2:e[3],nextMovesArr2:e[4],nextMovesTotal2:e[5]}}),{c(){ae(t.$$.fragment),n=T("text"),r=A("Other Move(s)"),C(n,"x",o=e[7]/2-20),C(n,"y",l=e[6]+18),C(n,"class","svelte-lhg3t6")},m(e,o){ce(t,e,o),y(e,n,o),m(n,r),i=!0},p(e,r){const s={};512&r&&(s.tooltipData=e[9]),1&r&&(s.aggNextMove=e[0]),2&r&&(s.nextMovesArr=e[1]),4&r&&(s.nextMovesTotal=e[2]),8&r&&(s.aggNextMove2=e[3]),16&r&&(s.nextMovesArr2=e[4]),32&r&&(s.nextMovesTotal2=e[5]),t.$set(s),(!i||128&r&&o!==(o=e[7]/2-20))&&C(n,"x",o),(!i||64&r&&l!==(l=e[6]+18))&&C(n,"y",l)},i(e){i||(re(t.$$.fragment,e),i=!0)},o(e){oe(t.$$.fragment,e),i=!1},d(e){ue(t,e),e&&$(n)}}}function Ct(e){let t,n,r,o,l,i,s,a,c,u,f,p,d,g;const h=[Mt,wt],v=[];function b(e,t){return e[4].length>0?0:1}o=b(e),l=v[o]=h[o](e);const x=[Et,At],w=[];function A(e,t){return e[4].length>0?0:1}a=A(e),c=w[a]=x[a](e);let _=e[8]&&_t(e),S=function(e){let t;return{c(){t=M("div"),C(t,"id","tooltip"),C(t,"display","none"),N(t,"position","absolute"),N(t,"display","none"),C(t,"class","svelte-lhg3t6")},m(e,n){y(e,t,n)},d(e){e&&$(t)}}}();return{c(){t=T("svg"),n=T("g"),r=T("g"),l.c(),i=T("g"),s=T("g"),c.c(),_&&_.c(),p=E(),S&&S.c(),d=k(),C(r,"transform","translate(0,"+e[13]+")"),C(n,"class","bars-1"),C(s,"transform","translate(0,"+e[13]+")"),C(i,"class","bars-2"),C(i,"transform",u="translate("+(e[7]-e[14])+",0)"),C(t,"width",e[7]),C(t,"height",f=e[6]+20),C(t,"class","svelte-lhg3t6")},m(e,l){y(e,t,l),m(t,n),m(n,r),v[o].m(r,null),m(t,i),m(i,s),w[a].m(s,null),_&&_.m(t,null),y(e,p,l),S&&S.m(e,l),y(e,d,l),g=!0},p(e,[n]){let p=o;o=b(e),o===p?v[o].p(e,n):(te(),oe(v[p],1,1,(()=>{v[p]=null})),ne(),l=v[o],l?l.p(e,n):(l=v[o]=h[o](e),l.c()),re(l,1),l.m(r,null));let d=a;a=A(e),a===d?w[a].p(e,n):(te(),oe(w[d],1,1,(()=>{w[d]=null})),ne(),c=w[a],c?c.p(e,n):(c=w[a]=x[a](e),c.c()),re(c,1),c.m(s,null)),(!g||128&n&&u!==(u="translate("+(e[7]-e[14])+",0)"))&&C(i,"transform",u),e[8]?_?(_.p(e,n),256&n&&re(_,1)):(_=_t(e),_.c(),re(_,1),_.m(t,null)):_&&(te(),oe(_,1,1,(()=>{_=null})),ne()),(!g||128&n)&&C(t,"width",e[7]),(!g||64&n&&f!==(f=e[6]+20))&&C(t,"height",f)},i(e){g||(re(l),re(c),re(_),g=!0)},o(e){oe(l),oe(c),oe(_),g=!1},d(e){e&&$(t),v[o].d(),w[a].d(),_&&_.d(),e&&$(p),S&&S.d(e),e&&$(d)}}}function St(e,t,n){let r;u(e,ve,(e=>n(17,r=e)));let o,l,{aggNextMove:i}=t,{nextMovesArr:s}=t,{nextMovesArrDict:a}=t,{nextMovesTotal:c}=t,{aggNextMove2:f}=t,{nextMovesArr2:p}=t,{nextMovesTotal2:d}=t,{nextMovesArrDict2:g}=t,{h:h}=t,{w:v}=t;const m={w:v,bw:50,h:h,th:0},{th:b,bw:x}=m;return e.$$set=e=>{"aggNextMove"in e&&n(0,i=e.aggNextMove),"nextMovesArr"in e&&n(1,s=e.nextMovesArr),"nextMovesArrDict"in e&&n(15,a=e.nextMovesArrDict),"nextMovesTotal"in e&&n(2,c=e.nextMovesTotal),"aggNextMove2"in e&&n(3,f=e.aggNextMove2),"nextMovesArr2"in e&&n(4,p=e.nextMovesArr2),"nextMovesTotal2"in e&&n(5,d=e.nextMovesTotal2),"nextMovesArrDict2"in e&&n(16,g=e.nextMovesArrDict2),"h"in e&&n(6,h=e.h),"w"in e&&n(7,v=e.w)},[i,s,c,f,p,d,h,v,o,l,function(e,{san:t,count:i,fen:s,accCount:u,prevFens:f}){be.set(t.slice(-2));let p,m=document.getElementById("tooltip");m.innerHTML=`${t} was played ${i} times (${Math.round(i/c*100)}%)`,m.style.display="block",m.style.left=e.pageX+10+"px",m.style.top=e.pageY+10+"px";const y=x,$=v-x,w=(e,t,n)=>(e-t/2)*h/n+b;if(f){const e=w(u,i,d);p=Object.entries(f).map((([t,n])=>{const{accCount:r,count:o,san:l,i:i}=a[t],s=w(r,o,c);return{x1:y,x2:$,y1:s,y2:e,san:l,i:i,t:n/d*h}}))}else{const e=["0","1","2","3"].reduce(((e,t)=>[...e,...r[t][s].nxt.map((e=>e[0]))]),[]),t=[...new Set(e)];let n=u-i,o=0;p=t.map(((e,t)=>{const r=g[e],l=r.count/d*h,i=w(r.accCount,r.count,d),s=n*h/c+l/2;return n+=r.count,o+=r.count,{x1:y,x2:$,y1:s,y2:i,t:l,san:r.san,i:r.i}}));const l=(i-o)/c*h,a=u*h/c-l/2;p.push({x1:y,x2:$/2,y1:a,y2:h+20-l/2,t:l,c:"gray"})}n(9,l={san:t,count:i,fen:s,accCount:u,prevFens:f,curves:p}),console.log({tooltipData:l}),n(8,o=!0)},function(){be.set(!1),document.getElementById("tooltip").style.display="none",n(8,o=!1)},m,b,x,a,g]}class Nt extends de{constructor(e){super(),pe(this,e,St,Ct,i,{aggNextMove:0,nextMovesArr:1,nextMovesArrDict:15,nextMovesTotal:2,aggNextMove2:3,nextMovesArr2:4,nextMovesTotal2:5,nextMovesArrDict2:16,h:6,w:7})}}function Pt(e,t,n){const r=e.slice();return r[13]=t[n][0],r[14]=t[n][1],r[16]=n,r}function qt(e){let t,n,r,o=ct,l=[];for(let t=0;t<o.length;t+=1)l[t]=It(Pt(e,o,t));return{c(){t=M("div"),n=T("svg");for(let e=0;e<l.length;e+=1)l[e].c();C(n,"width",Dt),C(n,"height",r=20)},m(e,r){y(e,t,r),m(t,n);for(let e=0;e<l.length;e+=1)l[e].m(n,null)},p(e,t){if(0&t){let r;for(o=ct,r=0;r<o.length;r+=1){const i=Pt(e,o,r);l[r]?l[r].p(i,t):(l[r]=It(i),l[r].c(),l[r].m(n,null))}for(;r<l.length;r+=1)l[r].d(1);l.length=o.length}},d(e){e&&$(t),w(l,e)}}}function It(t){let n,r,o,l,i,s=t[13]+"";return{c(){n=T("g"),r=T("rect"),o=T("text"),l=A(s),C(r,"cx","0"),C(r,"cy","10"),C(r,"height",15),C(r,"width",15),C(r,"fill",t[14]),C(o,"x","15"),C(o,"y","12"),C(n,"transform",i="translate("+65*t[16]+",0)")},m(e,t){y(e,n,t),m(n,r),m(n,o),m(o,l)},p:e,d(e){e&&$(n)}}}function Lt(e){let t,n,r,o,l,i,s,a,c,u,f,p,d;o=new Nt({props:{h:Ot,w:Dt,aggNextMove:e[0],nextMovesArr:e[1],nextMovesTotal:e[3],nextMovesArrDict:e[2],aggNextMove2:e[4],nextMovesArr2:e[5],nextMovesTotal2:e[7],nextMovesArrDict2:e[6]}});let g=e[8]&&qt(e);return{c(){t=M("div"),n=M("h1"),n.textContent="Distribution of Next Two Moves",r=E(),ae(o.$$.fragment),l=E(),i=M("div"),s=M("label"),a=M("input"),c=A("\r\n            Generate colors by piece (default is index)"),u=E(),g&&g.c(),C(n,"align","center"),C(n,"font-size","28"),N(n,"margin","0"),N(n,"padding","0"),C(a,"type","checkbox"),N(i,"display","flex"),N(i,"flex-direction","row"),C(t,"class","container svelte-hl7s99")},m(h,v){y(h,t,v),m(t,n),m(t,r),ce(o,t,null),m(t,l),m(t,i),m(i,s),m(s,a),m(s,c),m(t,u),g&&g.m(t,null),f=!0,p||(d=_(a,"click",e[10]),p=!0)},p(e,[n]){const r={};1&n&&(r.aggNextMove=e[0]),2&n&&(r.nextMovesArr=e[1]),8&n&&(r.nextMovesTotal=e[3]),4&n&&(r.nextMovesArrDict=e[2]),16&n&&(r.aggNextMove2=e[4]),32&n&&(r.nextMovesArr2=e[5]),128&n&&(r.nextMovesTotal2=e[7]),64&n&&(r.nextMovesArrDict2=e[6]),o.$set(r),e[8]?g?g.p(e,n):(g=qt(e),g.c(),g.m(t,null)):g&&(g.d(1),g=null)},i(e){f||(re(o.$$.fragment,e),f=!0)},o(e){oe(o.$$.fragment,e),f=!1},d(e){e&&$(t),ue(o),g&&g.d(),p=!1,d()}}}const Dt=380,Ot=720;function Rt(e,t,n){let r,o;u(e,ve,(e=>n(11,r=e))),u(e,xe,(e=>n(8,o=e)));let l={},i=[],s={},a=0,c={},f=[],p={},d=0;const g=we.subscribe((e=>{console.log({newDataArr:e}),n(0,l=e.reduce(((e,t,n)=>{if(!t||!t.nxt)return{...e};let r={};return Object.entries(t.nxt).forEach((([t,n],o)=>{const l=n[0],i=n[1][0],s=n[1][1],a=e[l]?e[l][0]:0,c=parseInt(i)+a;r[l]=[c,s]})),{...e,...r}}),{}));let t=0;const o=Object.entries(l).sort(((e,t)=>t[1][0]-e[1][0])).map((([e,[n,r]])=>isNaN(n)?{san:r,count:0,accCount:0,fen:e}:(t+=n,{san:r,count:n,accCount:t,fen:e})));n(3,a=t);const u=o.filter((({fen:e,count:t})=>!0));n(1,i=[...u]),console.log("Parsed next move viz data:",{nextMovesArr:i,aggNextMove:l,nextMovesTotal:a}),n(2,s=i.reduce(((e,t,n)=>({...e,[t.fen]:{...t,i:n}})),{}));const g=i.map((({fen:e},t)=>{const n=["0","1","2","3"].map((t=>{const n=r[t][e];return null==n?(console.warn(`While checking future move 2: Fen (${e}) not recognized for level ${t}`),!1):n}));return{fenPrev:e,gameData:n}}));n(4,c=g.map((({fenPrev:e,gameData:t},n)=>t.reduce(((t,n,r)=>{if(!n)return t;let o={};return Object.entries(n.nxt).forEach((([n,r],l)=>{const i=r[0],s=r[1][1],a=t[i]?t[i].count:0,c=parseInt(r[1][0])+a;o[i]={count:c,san:s,fenPrev:e}})),{...t,...o}}),{}))).reduce(((e,t)=>(Object.keys(t).forEach((n=>{const r=t[n].count,o=t[n].fenPrev;n in e?t[n]={...t[n],count:r+e.count,prevFens:{...e[n].prevFens,[o]:r}}:t[n].prevFens={[o]:r}})),{...e,...t})),{})),t=0;const h=Object.entries(c).sort(((e,t)=>t[1].count-e[1].count)).map((e=>{const[n,{count:r,prevFens:o,san:l}]=e;return isNaN(r)?{san:l,count:0,accCount:0,fen:n,prevFens:[]}:(t+=r,{san:l,count:r,accCount:t,fen:n,prevFens:o})}));n(7,d=t),n(5,f=h),n(6,p=f.reduce(((e,t,n)=>({...e,[t.fen]:{...t,i:n}})),{})),console.log("Parsed 2 move viz data:",{nextMovesArr2:f,aggNextMove2:c,nextMovesTotal2:d})}));function h(e){xe.set(!e)}j(g);return[l,i,s,a,c,f,p,d,o,h,()=>h(o)]}class jt extends de{constructor(e){super(),pe(this,e,Rt,Lt,i,{})}}function Bt(t){let n,r,o,l=t[2]+"";return{c(){n=M("p"),r=A("While loading an error occurred: "),o=A(l),N(n,"color","red")},m(e,t){y(e,n,t),m(n,r),m(n,o)},p:e,i:e,o:e,d(e){e&&$(n)}}}function Kt(t){let n,r,o,l,i,s,a;return r=new st({}),l=new De({}),s=new jt({}),{c(){n=M("div"),ae(r.$$.fragment),o=E(),ae(l.$$.fragment),i=E(),ae(s.$$.fragment),C(n,"class","viz-container svelte-jmotdg")},m(e,t){y(e,n,t),ce(r,n,null),m(n,o),ce(l,n,null),m(n,i),ce(s,n,null),a=!0},p:e,i(e){a||(re(r.$$.fragment,e),re(l.$$.fragment,e),re(s.$$.fragment,e),a=!0)},o(e){oe(r.$$.fragment,e),oe(l.$$.fragment,e),oe(s.$$.fragment,e),a=!1},d(e){e&&$(n),ue(r),ue(l),ue(s)}}}function Qt(t){let n;return{c(){n=M("p"),n.textContent="Loading..."},m(e,t){y(e,n,t)},p:e,i:e,o:e,d(e){e&&$(n)}}}function zt(e){let t,n,r,o,l,i,s,a,c;l=new Re({});let u={ctx:e,current:null,token:null,hasCatch:!0,pending:Qt,then:Kt,catch:Bt,value:1,error:2,blocks:[,,,]};return function(e,t){const n=t.token={};function r(e,r,o,l){if(t.token!==n)return;t.resolved=l;let i=t.ctx;void 0!==o&&(i=i.slice(),i[o]=l);const s=e&&(t.current=e)(i);let a=!1;t.block&&(t.blocks?t.blocks.forEach(((e,n)=>{n!==r&&e&&(te(),oe(e,1,1,(()=>{t.blocks[n]===e&&(t.blocks[n]=null)})),ne())})):t.block.d(1),s.c(),re(s,1),s.m(t.mount(),t.anchor),a=!0),t.block=s,t.blocks&&(t.blocks[r]=s),a&&X()}if((o=e)&&"object"==typeof o&&"function"==typeof o.then){const n=R();if(e.then((e=>{O(n),r(t.then,1,t.value,e),O(null)}),(e=>{if(O(n),r(t.catch,2,t.error,e),O(null),!t.hasCatch)throw e})),t.current!==t.pending)return r(t.pending,0),!0}else{if(t.current!==t.then)return r(t.then,1,t.value,e),!0;t.resolved=e}var o}(e[0],u),{c(){t=M("link"),n=M("html"),r=E(),o=M("main"),ae(l.$$.fragment),i=E(),u.block.c(),s=E(),a=M("p"),a.innerHTML='Build with Svelte and SVG. Visit the <a href="https://svelte.dev/tutorial">Svelte tutorial</a> to learn how to build Svelte apps.',document.title="Chess Viz",C(t,"rel","icon"),C(t,"type","image/svg"),C(t,"href","./img/chesspieces/wikipedia/wQ.png"),C(n,"lang","en")},m(e,f){m(document.head,t),m(document.head,n),y(e,r,f),y(e,o,f),ce(l,o,null),m(o,i),u.block.m(o,u.anchor=null),u.mount=()=>o,u.anchor=s,m(o,s),m(o,a),c=!0},p(t,[n]){!function(e,t,n){const r=t.slice(),{resolved:o}=e;e.current===e.then&&(r[e.value]=o),e.current===e.catch&&(r[e.error]=o),e.block.p(r,n)}(u,e=t,n)},i(e){c||(re(l.$$.fragment,e),re(u.block),c=!0)},o(e){oe(l.$$.fragment,e);for(let e=0;e<3;e+=1){oe(u.blocks[e])}c=!1},d(e){$(t),$(n),e&&$(r),e&&$(o),ue(l),u.block.d(),u.token=null,u=null}}}function Ft(e){return[fetch("games_2022_2M_filt10.json").then((e=>e.json())).then((e=>{ve.set(e)}))]}return new class extends de{constructor(e){super(),pe(this,e,Ft,zt,i,{})}}({target:document.body,props:{name:"world"}})}();
//# sourceMappingURL=bundle.js.map
